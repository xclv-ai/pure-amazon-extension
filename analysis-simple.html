<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POKPOK.AI - Tone Analysis</title>
    <link rel="stylesheet" href="styles/globals.css">
</head>
<body>
    <div class="extension-container">
        <!-- Header -->
        <div class="extension-header">
            <div class="logo-container">
                <div class="logo-text">
                    <span>[—</span><span class="logo-symbol" id="logoSymbol">*</span><span>—]</span>
                    <span> POKPOK.AI</span>
                </div>
                <button class="trigger-button" title="Trigger animation">
                    ✨
                </button>
            </div>
        </div>
        
        
        <!-- Selection Mode Module -->
        <div class="selection-module">
            <div class="mode-selector">
                <button class="mode-label active" id="fullPageMode">FULL PAGE</button>
                <button class="mode-label" id="selectionMode">SELECTION</button>
            </div>
            <div class="mode-track">
                <div class="track-line"></div>
                <div class="track-indicator" id="modeIndicator"></div>
            </div>
            <div class="selection-status">
                <span id="statusText">Full page mode active</span>
            </div>
            <button class="analyze-button active" id="mainAnalyzeBtn">
                ANALYZE FULL PAGE
            </button>
        </div>
        
        <!-- Parsed Content Display -->
        <div class="parsed-content-container hidden" id="parsedContentContainer">
            <div class="parsed-content-header">
                <div class="section-header">
                    <div class="section-title">
                        <span class="bracket parsed-content-bracket">[*]</span> PARSED CONTENT
                    </div>
                    <div class="section-toggle" id="parsedContentToggle">hide</div>
                </div>
            </div>
            <div class="parsed-content-body" id="parsedContentBody">
                <div class="parsed-text-content" id="parsedTextContent">
                    <!-- Selected text content will appear here -->
                </div>
                <div class="parsed-metadata" id="parsedMetadata">
                    <!-- Element metadata will appear here -->
                </div>
            </div>
        </div>
        
        <!-- Content -->
        <div class="extension-content" id="contentArea">
            <!-- Tone of Voice Analysis Card -->
            <div class="analysis-card">
                <div class="card-header pink">
                    <div class="card-title">
                        <span class="bracket">[*]</span> Tone of Voice Analysis
                    </div>
                    <div class="card-subtitle">Nielsen's 4-Dimensional Framework</div>
                    <div class="toggle">[-]</div>
                </div>
                <div class="card-content">
                    <div class="tone-item">
                        <div class="tone-header">
                            <div class="tone-title">Formal vs. Casual</div>
                            <div class="tone-score">2/5</div>
                        </div>
                        <div class="tone-position-row">
                            <div class="tone-position">Slightly Formal</div>
                            <button class="tone-details-btn">details</button>
                        </div>
                        <div class="slider-container">
                            <div class="slider-background"></div>
                            <div class="slider-indicator slider-pos-40"></div>
                        </div>
                    </div>
                    
                    <div class="tone-item">
                        <div class="tone-header">
                            <div class="tone-title">Serious vs. Funny</div>
                            <div class="tone-score">1/5</div>
                        </div>
                        <div class="tone-position-row">
                            <div class="tone-position">Completely Serious</div>
                            <button class="tone-details-btn">details</button>
                        </div>
                        <div class="slider-container">
                            <div class="slider-background"></div>
                            <div class="slider-indicator slider-pos-20"></div>
                        </div>
                    </div>
                    
                    <div class="tone-item">
                        <div class="tone-header">
                            <div class="tone-title">Respectful vs. Irreverent</div>
                            <div class="tone-score">1/5</div>
                        </div>
                        <div class="tone-position-row">
                            <div class="tone-position">Deeply Respectful</div>
                            <button class="tone-details-btn">details</button>
                        </div>
                        <div class="slider-container">
                            <div class="slider-background"></div>
                            <div class="slider-indicator slider-pos-20"></div>
                        </div>
                    </div>
                    
                    <div class="tone-item">
                        <div class="tone-header">
                            <div class="tone-title">Matter-of-fact vs. Enthusiastic</div>
                            <div class="tone-score">2/5</div>
                        </div>
                        <div class="tone-position-row">
                            <div class="tone-position">Slightly Matter-of-fact</div>
                            <button class="tone-details-btn">details</button>
                        </div>
                        <div class="slider-container">
                            <div class="slider-background"></div>
                            <div class="slider-indicator slider-pos-40"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Brand Archetypes Mix Card -->
            <div class="analysis-card">
                <div class="card-header teal">
                    <div class="card-title">
                        <span class="bracket">[*]</span> Brand Archetypes Mix
                    </div>
                    <div class="card-subtitle">Jung's 12 Archetypes Framework</div>
                    <div class="toggle">[-]</div>
                </div>
                <div class="card-content">
                    <div class="section-comment">// ARCHETYPE_SPECTRUM_ANALYSIS</div>
                    
                    <div class="spectrum-container">
                        <div class="spectrum-segment segment-yellow spectrum-primary" id="primarySegment">70%</div>
                        <div class="spectrum-segment segment-pink spectrum-secondary" id="secondarySegment">15%</div>
                        <div class="spectrum-segment segment-gray spectrum-tertiary" id="tertiarySegment">15%</div>
                    </div>
                    
                    <div class="archetype-list">
                        <div class="archetype-item">
                            <div class="archetype-badge yellow">70</div>
                            <div class="archetype-info">
                                <div class="archetype-name">The Innocent</div>
                                <div class="archetype-desc">Seeking happiness and simplicity</div>
                            </div>
                            <div class="archetype-rank primary">primary</div>
                        </div>
                        <div class="archetype-item">
                            <div class="archetype-badge pink">15</div>
                            <div class="archetype-info">
                                <div class="archetype-name">The Caregiver</div>
                                <div class="archetype-desc">Compassion and service to others</div>
                            </div>
                            <div class="archetype-rank">secondary</div>
                        </div>
                        <div class="archetype-item">
                            <div class="archetype-badge gray">15</div>
                            <div class="archetype-info">
                                <div class="archetype-name">The Sage</div>
                                <div class="archetype-desc">Driven by knowledge and truth</div>
                            </div>
                            <div class="archetype-rank">tertiary</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Visual Identity Card -->
            <div class="analysis-card">
                <div class="card-header pink">
                    <div class="card-title">
                        <span class="bracket">[*]</span> Visual Identity
                    </div>
                    <div class="card-subtitle">Brand Design & Aesthetic Analysis</div>
                    <div class="toggle">[-]</div>
                </div>
                <div class="card-content">
                    <div class="section-header">
                        <div class="section-title">
                            <span class="bracket">[ ]</span> LOOK & FEEL
                        </div>
                        <div class="section-toggle hidden">details</div>
                    </div>
                    
                    <div class="section-header">
                        <div class="section-title">
                            <span class="bracket">[*]</span> PRIMARY PALETTE
                        </div>
                        <div class="section-toggle">hide</div>
                    </div>
                    <div class="section-content">
                        <div class="section-comment">// PRIMARY_PALETTE</div>
                        <div class="color-palette">
                            <div class="color-item">
                                <div class="color-circle color-yellow-primary"></div>
                                <div class="color-hex">#F6F951</div>
                            </div>
                            <div class="color-item">
                                <div class="color-circle color-yellow-gold"></div>
                                <div class="color-hex">#FFD700</div>
                            </div>
                            <div class="color-item">
                                <div class="color-circle color-beige-light"></div>
                                <div class="color-hex">#F5DEB3</div>
                            </div>
                            <div class="color-item">
                                <div class="color-circle color-beige-tan"></div>
                                <div class="color-hex">#D2B48C</div>
                            </div>
                            <div class="color-item">
                                <div class="color-circle color-brown-saddle"></div>
                                <div class="color-hex">#8B4513</div>
                            </div>
                            <div class="color-item">
                                <div class="color-circle color-rose-brand"></div>
                                <div class="color-hex">#f1c7d6</div>
                            </div>
                        </div>
                        <p class="color-description">Predominantly warm yellows, beige, gold, and brown tones, often with pink accents for promotional text or specific claims.</p>
                    </div>
                    
                    <div class="section-header">
                        <div class="section-title">
                            <span class="bracket">[ ]</span> DISTINCTIVE ASSETS
                        </div>
                        <div class="section-toggle hidden">details</div>
                    </div>
                </div>
            </div>
            
            <!-- Brand Insights Card -->
            <div class="analysis-card">
                <div class="card-header pink">
                    <div class="card-title">
                        <span class="bracket">[*]</span> Brand Insights
                    </div>
                    <div class="card-subtitle">Strategic Brand Analysis</div>
                    <div class="toggle">[-]</div>
                </div>
                <div class="card-content">
                    <div class="section-header">
                        <div class="section-title">
                            <span class="bracket">[ ]</span> OVERALL PERCEPTION
                        </div>
                        <div class="section-toggle hidden">details</div>
                    </div>
                    
                    <div class="section-header">
                        <div class="section-title">
                            <span class="bracket">[ ]</span> COMMUNICATION FOCUS
                        </div>
                        <div class="section-toggle hidden">details</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Bar -->
        <div class="extension-footer">
            <div class="status-left">
                <div class="status-indicator"></div>
                <span>Connected</span>
            </div>
            <div class="version-text" id="versionText">POKPOK.AI v<span id="dynamicVersion">2.50.0</span></div>
        </div>
    </div>

    <!-- Settings Overlay -->
    <div class="settings-overlay hidden" id="settingsOverlay">
        <div class="settings-container">
            <!-- Settings Header -->
            <div class="settings-header">
                <div class="settings-title">
                    <span class="bracket">[*]</span> SETTINGS
                </div>
                <button class="settings-hide-btn" id="settingsHideBtn">hide</button>
            </div>
            
            <!-- Settings Content -->
            <div class="settings-content">
                <!-- Settings Loading Indicator -->
                <div class="settings-loading hidden" id="settingsLoading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading saved settings...</div>
                </div>
                
                <form class="settings-form" id="settingsForm">
                    <!-- AI Engine Selection Section -->
                    <div class="settings-section">
                        <div class="section-label">
                            <span class="bracket">[ ]</span> AI ENGINE SELECTION
                        </div>
                        <div class="form-group">
                            <label class="form-label">Analysis Engine</label>
                            <div class="ai-toggle-container">
                                <div class="ai-toggle-wrapper">
                                    <button type="button" class="ai-toggle-btn active" id="localAiBtn" data-engine="local">
                                        Local AI
                                    </button>
                                    <button type="button" class="ai-toggle-btn" id="cloudAiBtn" data-engine="cloud">
                                        Cloud AI
                                    </button>
                                </div>
                            </div>
                            <div class="ai-engine-description" id="aiEngineDescription">
                                <div class="engine-title">
                                    Local AI (compromise.js)
                                </div>
                                <div class="engine-details">
                                    ✓ Fast offline analysis<br>
                                    ✓ No API costs<br>
                                    ✓ Complete privacy<br>
                                    • Nielsen's 4-dimensional framework
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gemini API Section -->
                    <div class="settings-section">
                        <div class="section-label">
                            <span class="bracket">[ ]</span> GEMINI API CONFIGURATION
                        </div>
                        <div class="form-group">
                            <label for="apiKey" class="form-label">API Key</label>
                            <input type="password" id="apiKey" class="form-input" placeholder="Enter your Gemini API key">
                            <div class="form-hint">API keys are encrypted and stored locally. Consider using dedicated extension keys.</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="modelSelect" class="form-label">Model Selection</label>
                            <select id="modelSelect" class="form-select">
                                <option value="gemini-2.5-pro">Gemini 2.5 PRO</option>
                                <option value="gemini-2.5-flash" selected>Gemini 2.5 Flash</option>
                                <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
                            </select>
                        </div>
                        
                        
                        <div class="form-group" id="advancedFeaturesGroup">
                            <label class="form-label">Advanced API Features</label>
                            <div class="form-hint" style="margin-bottom: 12px;">Fine-tune individual Gemini API 2025 features</div>
                            
                            <div class="feature-checkboxes" id="featureCheckboxes">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="thinkingMode" class="feature-checkbox" checked>
                                    <label for="thinkingMode" class="checkbox-label">
                                        <span class="feature-name">Thinking Mode</span>
                                        <span class="feature-desc">Enhanced reasoning with 2048 token thinking budget</span>
                                    </label>
                                </div>
                                
                                <div class="checkbox-group">
                                    <input type="checkbox" id="urlContext" class="feature-checkbox" checked>
                                    <label for="urlContext" class="checkbox-label">
                                        <span class="feature-name">URL Context</span>
                                        <span class="feature-desc">Direct webpage analysis without manual content upload</span>
                                    </label>
                                </div>
                                
                                <div class="checkbox-group">
                                    <input type="checkbox" id="googleSearch" class="feature-checkbox" checked>
                                    <label for="googleSearch" class="checkbox-label">
                                        <span class="feature-name">Google Search</span>
                                        <span class="feature-desc">Dynamic search integration with citation support</span>
                                    </label>
                                </div>
                                
                                <div class="checkbox-group">
                                    <input type="checkbox" id="highTemperature" class="feature-checkbox" checked>
                                    <label for="highTemperature" class="checkbox-label">
                                        <span class="feature-name">High Temperature (1.0)</span>
                                        <span class="feature-desc">Use temperature 1.0 for grounding (recommended by Google)</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Google Drive Service Account Section -->
                    <div class="settings-section">
                        <div class="section-label">
                            <span class="bracket">[ ]</span> GOOGLE DRIVE SERVICE ACCOUNT
                        </div>
                        <div class="form-group">
                            <label for="serviceAccountKey" class="form-label">Service Account JSON</label>
                            <textarea id="serviceAccountKey" class="form-input" rows="8" placeholder='Paste your service account JSON here:
{
  "type": "service_account",
  "project_id": "your-project",
  "private_key_id": "...",
  "private_key": "-----BEGIN PRIVATE KEY-----\n...",
  "client_email": "your-service@project.iam.gserviceaccount.com",
  "client_id": "...",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token"
}'></textarea>
                            <div class="form-hint">
                                <strong>🔐 Security:</strong> JSON will be encrypted and stored locally. 
                                <br>📁 Ensure you've shared your Drive folder with the service account email.
                                <br>🔗 <a href="https://console.cloud.google.com/iam-admin/serviceaccounts" target="_blank" style="color: #2d5a5a;">Create Service Account</a>
                            </div>
                            <div class="service-account-status" id="serviceAccountStatus" style="margin-top: 8px; font-size: 12px; display: none;">
                                <span class="status-indicator"></span>
                                <span class="status-text"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button type="button" class="btn btn-secondary" id="testDriveConnectionBtn" style="font-size: 12px;">Test Drive Connection</button>
                                <button type="button" class="btn btn-secondary" id="clearServiceAccountBtn" style="font-size: 12px; background: #dc3545; border-color: #dc3545;">Clear Credentials</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Supabase Section -->
                    <div class="settings-section">
                        <div class="section-label">
                            <span class="bracket">[ ]</span> SUPABASE DATABASE
                        </div>
                        <div class="form-group">
                            <label for="supabaseDb" class="form-label">Database Name</label>
                            <input type="text" id="supabaseDb" class="form-input" placeholder="Enter Supabase database name">
                            <div class="form-hint">Database configuration for archetype analysis storage.</div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="settings-actions">
                        <button type="button" class="btn btn-secondary" id="testConnectionBtn">Check Connection</button>
                        <button type="submit" class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
                    </div>
                    
                    <!-- Security Notice -->
                    <div class="security-notice">
                        <div class="notice-icon">⚠️</div>
                        <div class="notice-text">
                            <strong>Security Notice:</strong> API keys are encrypted but stored locally in browser storage. 
                            For maximum security, use dedicated API keys for browser extensions only.
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Tone Controls Popover -->
    <div class="tone-popover" id="tonePopover">
        <div class="popover-header">
            <div class="popover-control-title">
                [ ] TONETOOLS.CONTROL
            </div>
            <div class="popover-control-subtitle">
                /NIELSEN/4DIMENSIONS
            </div>
        </div>
        <div class="popover-content">
            <div class="popover-control-section">
                /PARAMETERS
            </div>
            <!-- Slider controls will be inserted here -->
        </div>
        <div class="popover-footer">
            <button class="popover-control-button">
                [R] Reset
            </button>
            <div class="popover-action-buttons">
                <button id="cancelToneControls" class="popover-cancel-btn">
                    Cancel
                </button>
                <button id="applyToneControls" class="popover-apply-btn">
                    Apply
                </button>
            </div>
        </div>
    </div>

    <!-- Centralized Version Management -->
    <script src="js/version.js"></script>
    <script>
        // Set dynamic version display when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            const versionElement = document.getElementById('dynamicVersion');
            if (versionElement && window.POKPOK_VERSION) {
                versionElement.textContent = window.POKPOK_VERSION;
            }
        });
    </script>
    
    <script src="js/ai-toggle.js"></script>

    <script src="lib/compromise.min.js"></script>
    <!-- Modular JavaScript Architecture -->
    <script src="js/basic_analysis.js"></script>
    <script src="js/content-generators.js"></script>
    <script src="js/chrome-api.js"></script>
    <!-- Settings Tab System -->
    <script src="js/SettingsTabs.js"></script>
    <script src="js/ApiSettings.js"></script>
    <script src="js/WhiteLabelSettings.js"></script>
    <script src="js/AnalysisSettings.js"></script>
    <script src="js/Settings.js"></script>
    <script src="js/AnimatedLogo.js"></script>
    <script src="js/StatusBar.js"></script>
    <script src="js/Navigation.js"></script>
    <script src="js/ContentAnalysisSwitch.js"></script>
    <script src="js/ToneAnalysisDisplay.js"></script>
    <script src="js/CompromiseDemo.js"></script>
    <script src="js/BrandAnalysisCards.js"></script>
    <script src="js/GeminiAnalysisService.js"></script>
    <!-- Secure Google Drive Service Account -->
    <script src="js/SecureStorage.js"></script>
    <script src="js/JWTGenerator.js"></script>
    <script src="js/ServiceAccountSettings.js"></script>
    <script src="js/GoogleDriveService.js"></script>
    <!-- New Modular Architecture (Phase 1) -->
    <script src="js/ConsoleToButtonBridge.js"></script>
    <script src="js/UIController.js"></script>
    <script src="js/DataProcessor.js"></script>
    <script src="js/ContentHandler.js"></script>
    <script src="js/SettingsManager.js"></script>
    <script src="js/AnalysisCoordinator.js"></script>
    <script src="js/event-handlers.js"></script>
    <!-- Color analysis modules for FULL_PAGE mode -->
    <script src="js/color-extractor.js"></script>
    <script src="js/visual-identity-updater.js"></script>
    <!-- Legacy monolithic script (updated to delegate to new architecture) -->
    <script src="analysis.js"></script>
</body>
</html>